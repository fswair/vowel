# yaml-language-server: $schema=vowel-schema.json

fixtures:
  db:
    cls: db.Connection # setup cls
    kwargs:
      db_path: users.db ## db.Connection(db_path="users.db")
    teardown: db.Connection.close # teardown method (db.Connection.close())
    scope: module # scope 

db.Connection.execute:
  fixture:
    - db # db.execute(query) -> self is the db fixture instance
  evals:
    IsDict:
      type: list[dict[str, typing.Union[str, int]]] # type assertion for output
  dataset:
    - case:
        input: "SELECT * FROM users WHERE id=1" 
        assertion: "output and isinstance(output[0], dict)"
    - case:
        input: "SELECT * FROM notes" # (buggy query - invalid table)
        raises: any # if any exception is raised, the case will pass.
        match: "no such table" ## no effect, because any exception is accepted
    - case:
        input: "SELECT * FROM players" # (buggy query - invalid table)
        raises: any? # if any exception is raised/returned normally, the case will pass.
        match: "no such table" ## no effect, because any exception or normal return is enough
    - case:
        input: "SELECT * FROM developers" # (buggy query - invalid table)
        raises: NoTableError
        match: "no such table" ## must match the exception message (case ignored)